<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pedidos | El Mariachi</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{--primary:#ff9f43;--dark:#0d0d0d;--card-bg:#1a1a1a;--border:#2a2a2a;--text:#e0e0e0}
    body{background:var(--dark);color:var(--text);font-family:Segoe UI,Arial;margin:0;padding:12px}
    .navbar{background:linear-gradient(135deg,#1a1a1a,#2a2a2a);border-bottom:2px solid var(--primary)}
    .navbar-brand{color:var(--primary)!important;font-weight:700}
    .container{padding:12px}
    .card{background:var(--card-bg);border:1px solid var(--border)}
    .muted{color:#999}
  </style>
</head>
<body>

  <nav class="navbar navbar-dark">
    <div class="container d-flex justify-content-between align-items-center">
      <a class="navbar-brand" href="B-09ConstruccionPedido.html">ğŸŒ® El Mariachi</a>
      <a href="B-09ConstruccionPedido.html" class="btn btn-outline-light btn-sm">â† CatÃ¡logo</a>
    </div>
  </nav>

  <div class="container">
    <h4 class="mt-3 mb-3">Mis Pedidos</h4>
    <div id="ordersContainer"></div>
  </div>

<script>
  const ordersKey = 'orders';
  function loadOrders(){
    try { return JSON.parse(localStorage.getItem(ordersKey) || 'null') || []; }
    catch { return []; }
  }
  function saveOrders(list){ localStorage.setItem(ordersKey, JSON.stringify(list)); }

  function getStatusBadge(status){
    if(status === 'delivered') return '<span class="badge bg-success">âœ“ Entregado</span>';
    if(status === 'preparing') return '<span class="badge" style="background:#ff9f43;color:#111">â³ En preparaciÃ³n</span>';
    if(status === 'cancelled') return '<span class="badge bg-secondary">âœ— Cancelado</span>';
    return '<span class="badge bg-secondary">' + status + '</span>';
  }

  function renderOrders(){
    const container = document.getElementById('ordersContainer');
    const orders = loadOrders().sort((a,b) => b.createdAt - a.createdAt);
    
    if(orders.length === 0){ 
      container.innerHTML = '<div class="card p-4"><div class="muted text-center">No hay pedidos aÃºn. <a href="B-09ConstruccionPedido.html" style="color:var(--primary)">Ir al catÃ¡logo</a></div></div>'; 
      return; 
    }
    
    container.innerHTML = orders.map(o => `
      <div class="card mb-3 p-3">
        <div class="d-flex justify-content-between align-items-start">
          <div class="flex-grow-1">
            <div class="d-flex align-items-center gap-2 mb-2">
              <h5 class="mb-0">#${o.id}</h5>
              ${getStatusBadge(o.status)}
            </div>
            <div class="muted" style="font-size:13px">
              ${o.items.map(i=>`${i.qty}x ${i.name}`).join(', ')}
            </div>
            <small class="muted">Fecha: ${o.date}</small>
          </div>
          <div class="text-end">
            <div style="font-weight:700;color:var(--primary);font-size:16px;margin-bottom:8px">$${o.total.toLocaleString()}</div>
            <div class="d-flex flex-column gap-1">
              <a href="B-15BoletaDigital.html?id=${o.id}" class="btn btn-sm btn-outline-light">ğŸ“„ Boleta</a>
              ${o.status === 'preparing' ? `<button class="btn btn-sm btn-outline-danger cancel-btn" data-id="${o.id}">Anular</button>` : ''}
            </div>
          </div>
        </div>
      </div>
    `).join('');
    
    // Attach cancel handlers
    document.querySelectorAll('.cancel-btn').forEach(b=>{
      b.addEventListener('click', (ev)=>{
        const id = b.dataset.id;
        if(!confirm('Â¿Deseas anular este pedido?')) return;
        const list = loadOrders().map(x => x.id === id ? {...x, status:'cancelled'} : x);
        saveOrders(list);
        renderOrders();
      });
    });
  }

  renderOrders();
</script>

</body>
</html>

