<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Registro de Usuario ‚Ä¢ El Mariachi</title>
<style>
  :root{
    --bg:#0e0e0e; --panel:#141414; --card:#181818; --stroke:#222;
    --text:#e9e9e9; --muted:#bfbfbf; --btn:#ff9f43;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font:14px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial
  }
  .wrap{max-width:1100px;margin:24px auto;padding:12px}

  .canvas{
    position:relative;
    margin-top:14px;
    background:var(--panel);
    border:1px solid var(--stroke);
    border-radius:10px;
    min-height:360px;
    overflow:hidden;
  }

  /* tarjetas */
  .card{
    position:absolute;
    width:360px;
    background:var(--card);
    border:1px solid var(--stroke);
    border-radius:10px;
    box-shadow:0 10px 24px rgba(0,0,0,.35)
  }
  .card header{
    padding:10px 12px;
    border-bottom:1px solid var(--stroke);
    color:#d8d8d8;
    font-weight:600
  }
  .card .body{padding:12px}

  /* panel de registro (izquierda) */
  #form{left:24px;top:40px;width:360px}
  .group{margin-bottom:12px}
  label{display:block;margin:0 0 6px;color:#cfcfcf;font-size:13px}
  input[type="email"],input[type="password"]{
    width:100%;
    padding:10px;
    border-radius:6px;
    background:#0f0f0f;
    border:1px solid var(--stroke);
    color:var(--text)
  }
  .btn{
    display:inline-block;
    border:none;
    background:var(--btn);
    color:#1a1a1a;
    font-weight:700;
    padding:9px 14px;
    border-radius:8px;
    cursor:pointer
  }

  /* mensajes (derecha) */
  #mEmail{left:440px;top:40px}
  #mPass{left:440px;top:220px}
  .ok{
    display:inline-block;
    margin-top:10px;
    background:#e9e9e9;
    color:#111;
    border:none;
    padding:8px 18px;
    border-radius:6px;
    cursor:pointer
  }
</style>
</head>

<body>
  <div class="wrap">
    <div class="canvas">
      <!-- Registro -->
      <section class="card" id="form">
        <header>Registro de Usuario</header>
        <div class="body">
          <div class="group">
            <label for="email">Email:</label>
            <input id="email" type="email" placeholder="ana@example.com">
          </div>
          <div class="group">
            <label for="pass">Contrase√±a:</label>
            <input id="pass" type="password" placeholder="********">
          </div>
          <button class="btn" onclick="registrar()">Registrarse</button>
        </div>
      </section>

      <!-- Mensaje: email en uso -->
      <section class="card" id="mEmail" aria-hidden="true" style="display:none;">
        <header>Registro</header>
        <div class="body" style="text-align:center">
          <div style="margin:4px 0 8px;">El email ya est√° en uso.</div>
          <button class="ok" onclick="cerrarMensajes()">OK</button>
        </div>
      </section>

      <!-- Mensaje: contrase√±a no cumple -->
      <section class="card" id="mPass" aria-hidden="true" style="display:none;">
        <header>Registro</header>
        <div class="body" style="text-align:center">
          <div>La contrase√±a no cumple los<br>requisitos.</div>
          <button class="ok" onclick="cerrarMensajes()">OK</button>
        </div>
      </section>
    </div>
  </div>

<script>
  const API_URL = "http://localhost:4000/api/elmariachi/graphql";

  async function graphqlRequest(query) {
    const response = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query })
    });
    const data = await response.json();
    console.log("üì° Respuesta GraphQL:", data);
    return data;
  }

  function cerrarMensajes() {
    document.getElementById("mEmail").style.display = "none";
    document.getElementById("mPass").style.display = "none";
  }

  async function registrar() {
    cerrarMensajes();

    const email = document.getElementById("email").value;
    const pass  = document.getElementById("pass").value;

    if (!email || !pass) {
      alert("Debes completar ambos campos.");
      return;
    }

    const query = `
      mutation {
        crear_cliente(
          nombre: "${email}",
          email: "${email}",
          direccion: "No definida",
          telefono: "-----"
        ) {
          ok
          mensaje
        }
      }
    `;

    const data = await graphqlRequest(query);
    const res  = data.data.crear_cliente;

    if (!res.ok && res.mensaje.includes("ya est√°")) {
      document.getElementById("mEmail").style.display = "block";
    } else if (!res.ok) {
      document.getElementById("mPass").style.display = "block";
    } else {
      alert("Usuario registrado con √©xito");
    }
  }
</script>

</body>
</html>




